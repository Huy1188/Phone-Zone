<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Chỉnh sửa thông tin thành viên</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      /* 1. GLOBAL STYLE */
      :root {
        --primary-color: #4f46e5; /* Tím xanh */
        --primary-hover: #4338ca;
        --bg-color: #f3f4f6;
        --text-color: #1f2937;
        --border-color: #e5e7eb;
        --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }

      body {
        margin: 0;
        font-family: "Inter", sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        font-size: 14px;
      }

      .wrapper {
        display: flex;
        width: 100%;
        min-height: 100vh;
      }
      .main-column {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow-x: hidden;
      }
      .content-container {
        flex: 1;
        padding: 40px;
      }

      /* 2. CARD BOX */
      .card-box {
        background: white;
        padding: 40px;
        border-radius: 12px;
        box-shadow: var(--card-shadow);
        max-width: 850px;
        margin: 0 auto;
        border-top: 5px solid var(--primary-color);
      }

      h2 {
        text-align: center;
        color: var(--text-color);
        font-weight: 600;
        margin-top: 0;
        margin-bottom: 30px;
        font-size: 24px;
        border-bottom: 1px solid #eee;
        padding-bottom: 20px;
      }

      /* 3. FORM INPUTS */
      .form-group {
        margin-bottom: 24px;
      }
      label {
        font-weight: 500;
        display: block;
        margin-bottom: 8px;
        color: #374151;
      }

      input[type="text"],
      input[type="email"] {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        box-sizing: border-box;
        font-size: 14px;
        transition: all 0.2s;
        background-color: #fff;
      }
      input:focus {
        border-color: var(--primary-color);
        outline: none;
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
      }
      input[readonly] {
        background-color: #f9fafb;
        color: #6b7280;
        cursor: not-allowed;
      }

      .row {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
      }
      .col {
        flex: 1;
        min-width: 200px;
      }

      /* 4. ADDRESS SECTION */
      h4 {
        margin-top: 30px;
        color: #111827;
        font-size: 16px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .address-section {
        background: #f9fafb;
        border: 1px solid var(--border-color);
        border-radius: 10px;
        padding: 15px;
        margin-top: 15px;
        max-height: 400px;
        overflow-y: auto;
      }

      .address-item {
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        margin-bottom: 10px;
        padding: 15px;
        display: flex;
        align-items: center;
        gap: 15px;
        transition: 0.2s;
      }
      .address-item:hover {
        border-color: var(--primary-color);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }

      input[type="radio"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
        accent-color: var(--primary-color);
      }

      /* 5. BUTTONS */
      .btn-submit {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 14px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        width: 100%;
        font-size: 16px;
        margin-top: 30px;
        transition: 0.2s;
        box-shadow: 0 4px 6px rgba(79, 70, 229, 0.2);
      }
      .btn-submit:hover {
        background: var(--primary-hover);
        transform: translateY(-1px);
      }

      .btn-delete {
        background: #fee2e2;
        color: #ef4444;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        transition: 0.2s;
        text-decoration: none;
      }
      .btn-delete:hover {
        background: #ef4444;
        color: white;
      }

      .btn-back {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        margin-bottom: 20px;
        text-decoration: none;
        color: #6b7280;
        font-weight: 500;
      }
      .btn-back:hover {
        color: var(--primary-color);
      }

      /* New Address Box */
      .new-address-box {
        margin-top: 25px;
        padding: 20px;
        background: #f0fdf4;
        border: 1px dashed #86efac;
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <%- include('./admin/sidebar.ejs') %>

      <div class="main-column">
        <%- include('./admin/header.ejs') %>

        <div class="content-container">
          <a href="/system/user-manage" class="btn-back">
            <i class="fas fa-arrow-left"></i> Quay lại danh sách
          </a>

          <div class="card-box">
            <h2>
              <i
                class="fas fa-user-edit"
                style="color: var(--primary-color)"
              ></i>
              Chỉnh sửa người dùng
            </h2>

            <form action="/put-crud" method="POST">
              <input
                type="text"
                name="user_id"
                value="<%= user.user_id %>"
                hidden
              />

              <div class="form-group">
                <label>Email (Read only):</label>
                <div style="position: relative">
                  <i
                    class="fas fa-envelope"
                    style="
                      position: absolute;
                      left: 12px;
                      top: 13px;
                      color: #9ca3af;
                    "
                  ></i>
                  <input
                    type="email"
                    name="email"
                    value="<%= user.email %>"
                    readonly
                    style="padding-left: 40px"
                  />
                </div>
              </div>

              <div class="row">
                <div class="col">
                  <div class="form-group">
                    <label>Họ:</label>
                    <input
                      type="text"
                      name="first_name"
                      value="<%= user.first_name %>"
                      required
                    />
                  </div>
                </div>
                <div class="col">
                  <div class="form-group">
                    <label>Tên:</label>
                    <input
                      type="text"
                      name="last_name"
                      value="<%= user.last_name %>"
                      required
                    />
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label>Số điện thoại:</label>
                <input
                  type="text"
                  name="phone"
                  value="<%= user.phone %>"
                  placeholder="Nhập số điện thoại..."
                />
              </div>

              <h4>
                <i class="fas fa-map-marker-alt" style="color: #ef4444"></i> Địa
                chỉ nhận hàng
              </h4>
              <p style="font-size: 13px; color: #6b7280; margin-bottom: 10px">
                Sửa trực tiếp vào ô bên dưới hoặc bấm thùng rác để xóa.
              </p>

              <div class="address-section">
                <% if (user.addresses && user.addresses.length > 0) { %> <%
                user.addresses.forEach(function(addr) { %>
                <div class="address-item">
                  <div title="Đặt làm mặc định">
                    <input type="radio" name="selected_default_id" value="<%=
                    addr.address_id %>" <%= (addr.is_default) ? 'checked' : ''
                    %>>
                  </div>

                  <div style="flex: 1">
                    <div class="row" style="margin-bottom: 10px; gap: 10px">
                      <input
                        type="text"
                        name="addresses[<%= addr.address_id %>][recipient_name]"
                        value="<%= addr.recipient_name %>"
                        placeholder="Tên người nhận"
                        style="flex: 1"
                      />

                      <input
                        type="text"
                        name="addresses[<%= addr.address_id %>][recipient_phone]"
                        value="<%= addr.recipient_phone %>"
                        placeholder="SĐT"
                        style="width: 140px"
                      />
                    </div>
                    <div class="row" style="gap: 10px">
                      <input
                        type="text"
                        name="addresses[<%= addr.address_id %>][street]"
                        value="<%= addr.street %>"
                        placeholder="Số nhà, đường..."
                        style="flex: 2"
                      />

                      <input
                        type="text"
                        name="addresses[<%= addr.address_id %>][city]"
                        value="<%= addr.city %>"
                        placeholder="Thành phố"
                        style="flex: 1"
                      />
                    </div>
                  </div>

                  <div>
                    <a
                      href="/delete-address?id=<%= addr.address_id %>&user_id=<%= user.user_id %>"
                      class="btn-delete"
                      onclick="return confirm('Xóa địa chỉ này?')"
                      title="Xóa địa chỉ"
                    >
                      <i class="fas fa-trash"></i>
                    </a>
                  </div>
                </div>
                <% }); %> <% } else { %>
                <div
                  style="
                    text-align: center;
                    padding: 20px;
                    color: #ef4444;
                    font-style: italic;
                  "
                >
                  User này chưa có địa chỉ nào!
                </div>
                <% } %>
              </div>

              <div class="new-address-box">
                <label style="color: #15803d"
                  >+ Thêm địa chỉ mới (Nếu cần):</label
                >
                <div class="row">
                  <div class="col" style="flex: 2">
                    <input
                      type="text"
                      name="new_street"
                      placeholder="Nhập địa chỉ (số nhà, đường)..."
                    />
                  </div>
                  <div class="col" style="flex: 1">
                    <input
                      type="text"
                      name="new_city"
                      placeholder="Tỉnh/Thành phố..."
                    />
                  </div>
                </div>
              </div>

              <button type="submit" class="btn-submit">
                <i class="fas fa-save"></i> LƯU THAY ĐỔI
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
